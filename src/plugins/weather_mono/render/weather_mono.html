{% extends "plugin.html" %}

{% block content %}
{% set metrics_on = plugin_settings.displayMetrics == "true" %}
{% set header_scale = plugin_settings.headerTextScale | default('100') %}
{% set main_scale = plugin_settings.mainTextScale | default('100') %}
{% set detail_scale = plugin_settings.detailTextScale | default('100') %}
{% set graph_on = plugin_settings.displayGraph == "true" %}
{% set header_alignment = plugin_settings.headerAlignment if plugin_settings.headerAlignment in ['left', 'center', 'right'] else 'center' %}
{% set legacy_borders_on = plugin_settings.sectionBorders in [true, 'true', 'True', 1, '1'] %}
{% if plugin_settings.sectionBorderStyle in ['none', 'corner', 'top-bottom', 'rectangle'] %}
  {% set section_border_style = plugin_settings.sectionBorderStyle %}
{% else %}
  {% set section_border_style = 'rectangle' if legacy_borders_on else 'none' %}
{% endif %}
<div class="mono-weather-dashboard {% if section_border_style != 'none' %}with-borders section-border-{{ section_border_style }}{% endif %} header-align-{{ header_alignment }}" style="--header-scale: {{ header_scale | int / 100 }}; --main-scale: {{ main_scale | int / 100 }}; --detail-scale: {{ detail_scale | int / 100 }};">
  {% if plugin_settings.displayRefreshTime == "true" %}
    <div class="last-refresh">Updated {{ last_refresh_time }}</div>
  {% endif %}

  <div class="header">
    <div class="title">{{ title }}</div>
    <div class="current-date">{{ current_date }}</div>
  </div>

  <div class="main-row {% if not metrics_on %}no-metrics{% endif %}">
    <div class="current-panel panel {% if graph_on %}graph-enabled{% endif %}">
      {% if graph_on %}
      <div class="current-side-meta">
        <div class="feels-like">Feels Like {{ feels_like }}{% if units != "standard" %}°{% endif %}</div>
        <div class="min-max">High {{ forecast[0].high }}{% if units != "standard" %}°{% endif %}</div>
        <div class="min-max">Low {{ forecast[0].low }}{% if units != "standard" %}°{% endif %}</div>
      </div>
      {% endif %}

      <div class="current-values">
        <div class="current-temp">{{ current_temperature }}<span class="temperature-unit">{{ temperature_unit }}</span></div>
        {% if not graph_on %}
        <div class="temp-meta-row">
          <div class="feels-like">Feels Like {{ feels_like }}{% if units != "standard" %}°{% endif %} · </div>
          <div class="min-max">High {{ forecast[0].high }}{% if units != "standard" %}°{% endif %} · Low {{ forecast[0].low }}{% if units != "standard" %}°{% endif %}</div>
        </div>
        {% endif %}
      </div>
      <div class="current-icon-wrap">
        <span class="material-symbols-outlined current-icon" aria-hidden="true">{{ current_icon_token }}</span>
      </div>
    </div>

    {% if metrics_on %}
    <div class="metrics panel">
      {% for dp in data_points %}
        <div class="metric-row">
          <span class="metric-label">
            <span class="material-symbols-outlined metric-icon" aria-hidden="true">{{ dp.icon_token }}</span>
            {{ dp.label }}
          </span>
          <span class="metric-value">
            {{ dp.measurement }}{% if dp.unit %} {{ dp.unit }}{% endif %}{% if dp.label == "Wind" %} {{ dp.arrow }}{% endif %}
          </span>
        </div>
      {% endfor %}
    </div>
    {% endif %}
  </div>

  {% if graph_on %}
    <div class="hourly panel">
      {% for hour in hourly_forecast[:8] %}
        <div class="hourly-item">
          <span class="hourly-time">{{ hour.time }}</span>
          <span class="hourly-temp">{{ hour.temperature }}{% if units != "standard" %}°{% endif %}</span>
          <span class="hourly-pop">{{ (hour.precipitation * 100) | round | int }}%</span>
          {% if plugin_settings.displayRain == "true" %}
          <span class="hourly-rain">{{ hour.rain }}</span>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  {% endif %}

  {% if plugin_settings.displayForecast and plugin_settings.displayForecast == "true" %}
  <div class="forecast">
    {% for day in forecast[1:(plugin_settings.forecastDays | int) + 1] %}
      <div class="forecast-day panel">
        <div class="forecast-day-name">{{ day.day }}</div>
        <span class="material-symbols-outlined forecast-icon" aria-hidden="true">{{ day.icon_token }}</span>
        <div class="forecast-temps">{{ day.high }}{% if units != "standard" %}°{% endif %} / {{ day.low }}{% if units != "standard" %}°{% endif %}</div>
        {% if plugin_settings.moonPhase and plugin_settings.moonPhase == "true" %}
        <div class="moon-phase">
          <span class="material-symbols-outlined moon-phase-icon" aria-hidden="true">{{ day.moon_icon_token }}</span>
          <span>{{ day.moon_phase_pct }}%</span>
        </div>
        {% endif %}
      </div>
    {% endfor %}
  </div>
  {% endif %}
</div>
{% endblock %}
